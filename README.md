# fix-parser

## Overview

A high-performance FIX (Financial Information eXchange) protocol message parser implemented in Java. The parser is
designed
for efficient parsing and minimal object allocation.

## Usage Example

```java
// Initialize parser with FIX 4.4 specification
FixSpec spec = new FixSpecParser(new File("FIX44.xml")).parse();
FixMessageParser parser = new FixMessageParser(spec);

// Parse a FIX message
String fixMsg = "8=FIX.4.4\u00019=176\u000135=D\u000149=BUYER\u000156=SELLER\u000134=1\u0001" +
    "52=20230615-14:30:00.000\u000111=123456\u000155=IBM\u000154=1\u000144=150.25\u0001" +
    "38=1000\u000110=128\u0001";
NewOrderSingleMessage message = (NewOrderSingleMessage) parser.parse(fixMsg.getBytes(StandardCharsets.ISO_8859_1));

// Access fields using type-safe getters
String symbol = message.getInstrument().getSymbol();
double price = message.getPrice();
double orderQty = message.getOrderQtyData().getOrderQty();
```

## Key Features

- Zero-copy parsing of FIX messages
- Direct byte array access for maximum performance
- Support for FIX 4.4 message types with type-safe access

## Technical Details

### Implementation Assumptions

1. Message Format: Messages are well-formed according to [FIX TagValue Encoding][fix-tag-value-encoding]

### Benchmark Results

The parser includes comprehensive benchmarks (see [`docs/`](./docs/) for detailed results) for:

- Simple message parsing
- Complex message parsing with repeating groups
- Field access performance (String, Double, Int)
- Repeating group access
- Memory allocation monitoring
- Report on GC impact

We run `FixParserBenchmark.java` with
`-XX:+UnlockExperimentalVMOptions -XX:+UseEpsilonGC -Xms6g -Xmx6g -XX:+AlwaysPreTouch`
to measure the performance accurately of the parser with minimal GC interruption.

### Implementation Details

1. Direct byte array access with wrapped classes generated from FIX specification XML:
    - [`UnderlyingMessage`](./fix-parser-base/src/main/java/fix/parser/message/base/UnderlyingMessage.java) is created
      to
      store the original message bytes and index arrays for efficient field access.
    - [`Segment`](./fix-parser-base/src/main/java/fix/parser/message/base/Segment.java) is created to represent a
      segment of a
      FIX message, which can be either the main message or a repeating group. It also provides value getters.
    - Messages classes are generated by [
      `FixClassesGenerator`](./fix-parser-codegen/src/main/java/fix/parser/codegen/FixClassesGenerator.java)
      from FIX specification XML, and they are nothing but a wrapper of `Segment` with type-safe getters.
    - [`FixMessageParser`](./fix-parser-impl/src/main/java/fix/parser/impl/FixMessageParser.java) is created to parse
      the message
      bytes and create the `UnderlyingMessage` and `Segment` objects and then wrap them using generated message classes.
        - We use information from [`FixSpec`](./fix-parser-base/src/main/java/fix/parser/spec/FixSpec.java) to
          recursively
          parse repeating groups
        - We use information from [`FixSpec`](./fix-parser-base/src/main/java/fix/parser/spec/FixSpec.java) to tell a
          field
          separator is truly a separator or part of a data field.

1. Performance Optimizations
    - Pre-allocated arrays for meta information like tags array and value positions and lengths
    - Direct byte array parsing without String creation
    - Loop unrolling for efficient array iteration
    - Optimized tag number parsing without new String allocation
    - Pre-computed sets for field types (DATA, NUMINGROUP)
   - Index arrays for quick field lookup
    - No hash maps or dynamic collections during parsing
    - Switch case instead of reflection for more efficient message constructor invocation

1. Memory Usage
    - Stores original message bytes
    - Index arrays for field positions
    - Immutable message representation
    - Minimal object allocation during parsing

1. API Design
    - Type-safe message classes for FIX 4.4
    - Immutable message representation
    - Direct field access through getters

1. Error Handling
    - No semantic validation as we assume the messages are well formatted.

1. Thread Safety
   - Immutable message representation
   - Thread-safe after construction
   - No shared state between parser instances

## Requirements

- Java 21 or higher
- Maven 3.8.x or higher

## Building

```bash
mvn clean install
```

## References

### FIX Official Documentation

1. [FIX 4.2 Specification][fix-4-2]
1. [FIX Simple Binary Encoding (SBE)][fix-sbe]
1. [FIX TagValue Encoding][fix-tag-value-encoding]
1. [FIX Repeating Group][fix-repeating-group]

### YouTube Videos

1. [FIX protocol (explained by a quant developer)][youtube-fix-explained]

### AI Tools Used

1. [Augment Code][augment-code]
1. [Microsoft Copilot][copilot]

### Existing FIX Parsers

1. [QuickFIX/J][quickfixj] especially the FIX 4.4 XML specification file is copied
   from [FIX44.modified.xml][fix-4-4-xml]

[augment-code]: https://docs.augmentcode.com/introduction

[copilot]: https://copilot.microsoft.com/

[fix-4-2]: https://www.fixtrading.org/standards/fix-4-2/]

[fix-4-4-xml]: https://github.com/quickfix-j/quickfixj/blob/master/quickfixj-messages/quickfixj-messages-fix44/src/main/resources/FIX44.modified.xml

[fix-repeating-group]: https://ref.onixs.biz/fix-repeating-group.html

[fix-sbe]: https://www.fixtrading.org/standards/sbe/

[fix-tag-value-encoding]: https://www.fixtrading.org/standards/tagvalue-online/?form=MG0AV3&form=MG0AV3

[quickfixj]: https://github.com/quickfix-j/quickfixj

[youtube-fix-explained]: https://youtu.be/uZ8UEVhtPAo?si=uowAtfj_vtHk-uNp
